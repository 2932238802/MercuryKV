import{r as c,k as F,l as M,c as r,o as u,a as e,d as _,j as S,F as D,i as I,w as V,t as p,b as A,v as h,S as i,u as $}from"./index-BWLvCJGR.js";import{s as m}from"./request-7M7I0ryV.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"kv-manager-page"},O={class:"content-card"},q={class:"table-wrapper"},J={class:"kv-table"},W={class:"value-cell"},z={class:"value-text"},G={key:0,style:{color:"#999"}},Q={class:"actions-cell"},X=["onClick"],Y=["onClick"],Z=["onClick"],ee={key:0},te={colspan:"5",class:"empty-state"},ae={key:0,class:"modal-overlay"},se={class:"modal-content"},le={class:"form-group"},ne={class:"form-group"},oe={class:"form-group"},re={__name:"Mercury",setup(ue){const o=c([]),f=c(!1),b=c(!1),s=c(null),d=c(""),C=$(),v={CREATE:"create",UPDATE:"update"},g={FETCH:"/FetchData/fetch",CREATE:"/Alter/adddata",UPDATE:"/Alter/alterdata",DELETE:"/Alter/deletedata"},y=c(v.CREATE),x=F(()=>b.value?"Edit KV Pair":"Create KV Pair");function U(){C.push({name:"Index"})}function E(){localStorage.removeItem("AuthToken"),localStorage.removeItem("UserId"),C.push({name:"RegisterAndLogin"})}function T(){b.value=!1,s.value={key_input:"",value_input:"",tags:[]},d.value="",y.value=v.CREATE,f.value=!0}function H(l){b.value=!0,s.value=JSON.parse(JSON.stringify(l)),d.value=l.tags?l.tags.join(", "):"",y.value=v.UPDATE,f.value=!0}function w(){f.value=!1,s.value=null,d.value=""}async function R(){if(!s.value)return;const l=localStorage.getItem("UserId");if(!l){i("User not logged in Please re-login"),E();return}if(s.value.key_input.trim()===""||s.value.value_input.trim()===""){i("Key and Value cannot be empty!");return}const t=/[,\s，。.!-]+/,a=[...new Set(d.value.split(t).filter(n=>n.trim().length>0))];try{if(y.value===v.CREATE){const n={user_id:Number(l),key_input:s.value.key_input,value_input:s.value.value_input,tags:a},k=await m.post(g.CREATE,n);console.log("API /Alter/adddata returned:",k.data),o.value.unshift(k.data),i("Item created successfully!")}else if(y.value===v.UPDATE){const n={user_id:Number(l),kv_id:s.value.kv_id,key_input:s.value.key_input,value_input:s.value.value_input,tags:a},k=await m.put(g.UPDATE,n),P=o.value.findIndex(L=>L.kv_id===s.value.kv_id);P!==-1&&(o.value[P]=k.data),i("Item updated successfully!")}}catch(n){console.error("Submission failed:",n),i(n.response?.data?.message||n.message||"An unknown error occurred.")}w()}async function N(l){if(confirm(`你确定要删除这个"${l.key_input}"?`))try{const t=l.kv_id;await m.delete(`${g.DELETE}/${t}`),o.value=o.value.filter(a=>a.kv_id!==t),i("Item deleted successfully.")}catch(t){console.error("Deletion failed:",t),i(t.response?.data?.message||"Failed to delete item.")}}const K=async()=>{const l=localStorage.getItem("UserId");if(!l){E();return}try{const t=await m.get(g.FETCH,{params:{user_id:l}});o.value=t.data||[]}catch(t){console.error("Failed to fetch data:",t),i(" 数据加载失败 ")}};return M(()=>{K()}),(l,t)=>(u(),r("div",B,[e("div",O,[e("button",{class:"btn-return",onClick:U,title:"Go back"},t[3]||(t[3]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),e("header",{class:"kv-manager-header"},[t[6]||(t[6]=e("h1",null,"KV Store",-1)),e("div",{class:"toolbar"},[t[5]||(t[5]=e("input",{type:"text",class:"search-input",placeholder:"Search by key or tag...","aria-label":"Search Key-Value pairs"},null,-1)),e("button",{class:"btn-primary",onClick:T},"+ Add New"),e("button",{class:"btn-ghost",onClick:E,title:"Logout and login again"},t[4]||(t[4]=[e("i",{class:"fas fa-sign-out-alt"},null,-1),S(" Re-Login ")]))])]),e("div",q,[e("table",J,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",{class:"col-key"},"Key"),e("th",{class:"col-value"},"Value"),e("th",{class:"col-tags"},"Tags"),e("th",{class:"col-updated"},"Last Updated"),e("th",{class:"col-actions"},"Actions")])],-1)),e("tbody",null,[(u(!0),r(D,null,I(o.value,a=>(u(),r("tr",{key:a.kv_id},[e("td",null,p(a.key_input),1),e("td",W,[e("span",z,p(a.value_input),1)]),e("td",null,[(u(!0),r(D,null,I(a.tags,n=>(u(),r("span",{key:n,class:"tag"},p(n),1))),128)),!a.tags||a.tags.length===0?(u(),r("span",G,"-")):_("",!0)]),e("td",null,p(new Date(a.updated_at).toLocaleString()),1),e("td",Q,[e("button",{class:"btn-icon",title:"View History",onClick:n=>l.handleViewHistory(a)},t[7]||(t[7]=[e("i",{class:"fas fa-history"},null,-1)]),8,X),e("button",{class:"btn-icon",title:"Edit",onClick:n=>H(a)},t[8]||(t[8]=[e("i",{class:"fas fa-pencil-alt"},null,-1)]),8,Y),e("button",{class:"btn-icon btn-danger",title:"Delete",onClick:n=>N(a)},t[9]||(t[9]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Z)])]))),128)),!o.value||o.value.length===0?(u(),r("tr",ee,[e("td",te,[t[10]||(t[10]=S(" No Key-Value pairs found. ")),e("a",{href:"#",onClick:V(T,["prevent"])},"Add one now!")])])):_("",!0)])])]),t[12]||(t[12]=e("footer",{class:"kv-manager-footer"},[e("div",{class:"pagination"},[e("span",null,"Page 1 of 1"),e("button",{class:"btn-ghost",disabled:""},"< Prev"),e("button",{class:"btn-ghost",disabled:""},"Next >")])],-1))]),f.value?(u(),r("div",ae,[e("div",se,[s.value?(u(),r("form",{key:0,onSubmit:V(R,["prevent"])},[e("h1",null,p(x.value),1),e("div",le,[t[13]||(t[13]=e("label",{for:"kv-key"},"Key",-1)),A(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.key_input=a),id:"kv-key",type:"text",placeholder:"e.g., WiFi Password, API Key",required:""},null,512),[[h,s.value.key_input]])]),e("div",ne,[t[14]||(t[14]=e("label",{for:"kv-value"},"Value",-1)),A(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.value_input=a),id:"kv-value",rows:"5",placeholder:"e.g., 12345678, xyz-abc-123...",required:""},null,512),[[h,s.value.value_input]])]),e("div",oe,[t[15]||(t[15]=e("label",{for:"kv-tags"},"Tags (separated by comma, space, etc.)",-1)),A(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>d.value=a),id:"kv-tags",type:"text",placeholder:"e.g., Personal, Work, Project"},null,512),[[h,d.value]])]),e("div",{class:"modal-actions"},[e("button",{type:"button",class:"btn-ghost",onClick:w},"Cancel"),t[16]||(t[16]=e("button",{type:"submit",class:"btn-primary"},"Save",-1))])],32)):_("",!0)])])):_("",!0)]))}},ve=j(re,[["__scopeId","data-v-eb6baff6"]]);export{ve as default};
