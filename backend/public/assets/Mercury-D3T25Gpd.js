import{r as d,k as L,l as K,c as i,o as r,a as e,d as y,j as C,F as w,i as D,w as S,t as c,b,v as E,S as v,u as N}from"./index-DocNYFMK.js";import{s as f}from"./request-qL6EZeN4.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"kv-manager-page"},$={class:"content-card"},B={class:"table-wrapper"},j={class:"kv-table"},W={class:"value-cell"},q={class:"value-text"},z={key:0,style:{color:"#999"}},G={class:"actions-cell"},O=["onClick"],J=["onClick"],Q=["onClick"],X={key:0},Y={colspan:"5",class:"empty-state"},Z={key:0,class:"modal-overlay"},ee={class:"modal-content"},te={class:"form-group"},ae={class:"form-group"},le={class:"form-group"},se={__name:"Mercury",setup(ne){const o=d([{tag_id:1,kv_id:1,key_input:"test",value_input:"right",tags:"for_tset"}]),p=d(!1),k=d(!1),l=d(null),h=N(),u={CREATE:"create",UPDATE:"update"},g={FETCH:"/FetchData/fetch",CREATE:"/Alter/adddata",UPDATE:"/Alter/alterdata",DELETE:"/Alter/deletedata"},_=d(u.CREATE),P=L(()=>k.value?"Edit KV Pair":"Create KV Pair");function V(){h.push({name:"Index"})}function m(){localStorage.removeItem("AuthToken"),localStorage.removeItem("UserId"),h.push({name:"RegisterAndLogin"})}function A(){k.value=!1,l.value={key_input:"",value_input:"",tag_name:""},_.value=u.CREATE,p.value=!0}function I(s){k.value=!0,l.value={...s,tag_name:s.tag_name||""},_.value=u.UPDATE,p.value=!0}function T(){p.value=!1,l.value=null}async function R(){if(!l.value)return;const s=localStorage.getItem("UserId"),t=localStorage.getItem("AuthToken");if(!s||!t){v("User not logged in Please re-login"),m();return}if(l.value.key_input==""||l.value.value_input==""||l.value.tag_name==""){v("增加的key,value,tag不能为空哈！");return}try{if(_.value===u.CREATE){const a={user_id:Number(s),key_input:l.value.key_input,value_input:l.value.value_input,tag_name:l.value.tag_name},n=await f.post(g.CREATE,a);console.log("Response from create:",a.value),console.log("Response from create:",n.data),o.value.unshift({...l.value,kv_id:n.data.kv_id,tag_id:n.data.tag_id,updated_at:n.data.updated_at})}else if(_.value===u.UPDATE){const a={user_id:Number(s),kv_id:l.value.kv_id,key_input:l.value.key_input,value_input:l.value.value_input,tag_name:l.value.tag_name};await f.put(g.UPDATE,a);const n=o.value.findIndex(H=>H.kv_id===l.value.kv_id);n!==-1&&(o.value[n]={...l.value,updated_at:new Date().toLocaleString()})}}catch(a){console.error("Submission failed:",a),v(a.response?.data?.message||a.message||"An unknown error occurred.")}T()}async function U(s){if(confirm(`你确定要删除这个"${s.key_input}"?`)){console.log("Deleting item:",s);try{string_id=String(kv_id),await f.delete(`${g.DELETE}/${string_id}`),o.value=o.value.filter(t=>t.kv_id!==s.kv_id)}catch(t){console.error("Deletion failed:",t),v(t.message||"Failed to delete item.")}}}const x=async()=>{const s=localStorage.getItem("UserId");if(!s){m();return}try{const t=await f.get(g.FETCH,{params:{user_id:s}});o.value=t.data||[]}catch(t){console.error("Failed to fetch data:",t),v(" 数据加载失败 ")}};return K(()=>{x()}),(s,t)=>(r(),i("div",M,[e("div",$,[e("button",{class:"btn-return",onClick:V,title:"Go back"},t[3]||(t[3]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),e("header",{class:"kv-manager-header"},[t[6]||(t[6]=e("h1",null,"KV Store",-1)),e("div",{class:"toolbar"},[t[5]||(t[5]=e("input",{type:"text",class:"search-input",placeholder:"Search by key or tag...","aria-label":"Search Key-Value pairs"},null,-1)),e("button",{class:"btn-primary",onClick:A},"+ Add New"),e("button",{class:"btn-ghost",onClick:m,title:"Logout and login again"},t[4]||(t[4]=[e("i",{class:"fas fa-sign-out-alt"},null,-1),C(" Re-Login ")]))])]),e("div",B,[e("table",j,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",{class:"col-key"},"Key"),e("th",{class:"col-value"},"Value"),e("th",{class:"col-tags"},"Tags"),e("th",{class:"col-updated"},"Last Updated"),e("th",{class:"col-actions"},"Actions")])],-1)),e("tbody",null,[(r(!0),i(w,null,D(o.value,a=>(r(),i("tr",{key:a.kv_id},[e("td",null,c(a.key_input),1),e("td",W,[e("span",q,c(a.value_input),1)]),e("td",null,[(r(!0),i(w,null,D(a.tags,n=>(r(),i("span",{key:n,class:"tag"},c(n),1))),128)),!a.tags||a.tags.length===0?(r(),i("span",z,"-")):y("",!0)]),e("td",null,c(new Date(a.updated_at).toLocaleString()),1),e("td",G,[e("button",{class:"btn-icon",title:"View History",onClick:n=>s.handleViewHistory(a)},t[7]||(t[7]=[e("i",{class:"fas fa-history"},null,-1)]),8,O),e("button",{class:"btn-icon",title:"Edit",onClick:n=>I(a)},t[8]||(t[8]=[e("i",{class:"fas fa-pencil-alt"},null,-1)]),8,J),e("button",{class:"btn-icon btn-danger",title:"Delete",onClick:n=>U(a)},t[9]||(t[9]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,Q)])]))),128)),o.value.length?y("",!0):(r(),i("tr",X,[e("td",Y,[t[10]||(t[10]=C(" No Key-Value pairs found. ")),e("a",{href:"#",onClick:S(A,["prevent"])},"Add one now!")])]))])])]),t[12]||(t[12]=e("footer",{class:"kv-manager-footer"},[e("div",{class:"pagination"},[e("span",null,"Page 1 of 1"),e("button",{class:"btn-ghost",disabled:""},"< Prev"),e("button",{class:"btn-ghost",disabled:""},"Next >")])],-1))]),p.value?(r(),i("div",Z,[e("div",ee,[e("form",{onSubmit:S(R,["prevent"])},[e("h1",null,c(P.value),1),e("div",te,[t[13]||(t[13]=e("label",{for:"kv-key"},"Key",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.key_input=a),id:"kv-key",type:"text",placeholder:"e.g., WiFi Password, API Key",required:""},null,512),[[E,l.value.key_input]])]),e("div",ae,[t[14]||(t[14]=e("label",{for:"kv-value"},"Value",-1)),b(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.value_input=a),id:"kv-value",rows:"5",placeholder:"e.g., 12345678, xyz-abc-123..."},null,512),[[E,l.value.value_input]])]),e("div",le,[t[15]||(t[15]=e("label",{for:"kv-tags"},"Tags (comma-separated)",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>s.editabletags=a),id:"kv-tags",type:"text",placeholder:"e.g., Personal, Work, Project"},null,512),[[E,s.editabletags]])]),e("div",{class:"modal-actions"},[e("button",{type:"button",class:"btn-ghost",onClick:T},"Cancel"),t[16]||(t[16]=e("button",{type:"submit",class:"btn-primary"},"Save",-1))])],32)])])):y("",!0)]))}},ue=F(se,[["__scopeId","data-v-b7ee7e9c"]]);export{ue as default};
