import{r as d,k as U,l as H,c as i,o as r,a as e,d as y,j as C,F as L,i as N,w,t as c,b,v as h,S as g,u as F}from"./index-BieDrV-D.js";import{s as f}from"./request-CZVxKNCA.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"kv-manager-page"},$={class:"content-card"},B={class:"table-wrapper"},O={class:"kv-table"},j={class:"value-cell"},q={class:"value-text"},G={key:0,class:"tag"},J={class:"actions-cell"},z=["onClick"],Q=["onClick"],W=["onClick"],X={key:0},Y={colspan:"5",class:"empty-state"},Z={key:0,class:"modal-overlay"},ee={class:"modal-content"},te={class:"form-group"},ae={class:"form-group"},le={class:"form-group"},se={__name:"Mercury",setup(ne){const o=d([]),v=d(!1),m=d(!1),l=d(null),E=F(),u={CREATE:"create",UPDATE:"update"},p={FETCH:"/FetchData/fetch",CREATE:"/Alter/adddata",UPDATE:"/Alter/alterdata",DELETE:"/Alter/deletedata"},_=d(u.CREATE),D=U(()=>m.value?"Edit KV Pair":"Create KV Pair");function S(){E.push({name:"Index"})}function k(){localStorage.removeItem("AuthToken"),localStorage.removeItem("UserId"),E.push({name:"RegisterAndLogin"})}function A(){m.value=!1,l.value={key_input:"",value_input:"",tag_name:""},_.value=u.CREATE,v.value=!0}function V(s){m.value=!0,l.value={...s,tag_name:s.tag_name||""},_.value=u.UPDATE,v.value=!0}function T(){v.value=!1,l.value=null}async function P(){if(!l.value)return;const s=localStorage.getItem("UserId"),t=localStorage.getItem("AuthToken");if(!s||!t){g("User not logged in Please re-login"),k();return}try{if(_.value===u.CREATE){const a={user_id:Number(s),key_input:l.value.key_input,value_input:l.value.value_input,tag_name:l.value.tag_name},n=await f.post(p.CREATE,a);console.log("Response from create:",a.value),console.log("Response from create:",n.data),o.value.unshift({...l.value,kv_id:n.data.kv_id,tag_id:n.data.tag_id,updated_at:n.data.updated_at})}else if(_.value===u.UPDATE){const a={user_id:Number(s),kv_id:l.value.kv_id,key_input:l.value.key_input,value_input:l.value.value_input,tag_name:l.value.tag_name};await f.put(p.UPDATE,a);const n=o.value.findIndex(I=>I.kv_id===l.value.kv_id);n!==-1&&(o.value[n]={...l.value,updated_at:new Date().toLocaleString()})}}catch(a){console.error("Submission failed:",a),g(a.response?.data?.message||a.message||"An unknown error occurred.")}T()}async function R(s){if(confirm(`你确定要删除这个"${s.key_input}"?`)){console.log("Deleting item:",s);try{await f.delete(`${p.DELETE}/${s.kv_id}`),o.value=o.value.filter(t=>t.kv_id!==s.kv_id)}catch(t){console.error("Deletion failed:",t),g(t.response?.data?.message||"Failed to delete item.")}}}const x=async()=>{const s=localStorage.getItem("UserId");if(!s){k();return}try{const t=await f.get(p.FETCH,{params:{user_id:s}});o.value=t.data||[]}catch(t){console.error("Failed to fetch data:",t),g("Failed to load data. Please try logging in again.")}};return H(()=>{x()}),(s,t)=>(r(),i("div",M,[e("div",$,[e("button",{class:"btn-return",onClick:S,title:"Go back"},t[3]||(t[3]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),e("header",{class:"kv-manager-header"},[t[6]||(t[6]=e("h1",null,"KV Store",-1)),e("div",{class:"toolbar"},[t[5]||(t[5]=e("input",{type:"text",class:"search-input",placeholder:"Search by key or tag...","aria-label":"Search Key-Value pairs"},null,-1)),e("button",{class:"btn-primary",onClick:A},"+ Add New"),e("button",{class:"btn-ghost",onClick:k,title:"Logout and login again"},t[4]||(t[4]=[e("i",{class:"fas fa-sign-out-alt"},null,-1),C(" Re-Login ")]))])]),e("div",B,[e("table",O,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",{class:"col-key"},"Key(key_input)"),e("th",{class:"col-value"},"Value(value_input)"),e("th",{class:"col-tags"},"Tag(tag_name)"),e("th",{class:"col-updated"},"Last Updated(updated_at)"),e("th",{class:"col-actions"},"Actions")])],-1)),e("tbody",null,[(r(!0),i(L,null,N(o.value,a=>(r(),i("tr",{key:a.k},[e("td",null,c(a.key_input),1),e("td",j,[e("span",q,c(a.value_input),1)]),e("td",null,[a.tag_name?(r(),i("span",G,c(a.tag_name),1)):y("",!0)]),e("td",null,c(new Date(a.updated_at).toLocaleString()),1),e("td",J,[e("button",{class:"btn-icon",title:"View History",onClick:n=>s.handleViewHistory(a)},t[7]||(t[7]=[e("i",{class:"fas fa-history"},null,-1)]),8,z),e("button",{class:"btn-icon",title:"Edit",onClick:n=>V(a)},t[8]||(t[8]=[e("i",{class:"fas fa-pencil-alt"},null,-1)]),8,Q),e("button",{class:"btn-icon btn-danger",title:"Delete",onClick:n=>R(a)},t[9]||(t[9]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,W)])]))),128)),o.value.length?y("",!0):(r(),i("tr",X,[e("td",Y,[t[10]||(t[10]=C(" No Key-Value pairs found ")),e("a",{href:"#",onClick:w(A,["prevent"])},"Add one now!")])]))])])]),t[12]||(t[12]=e("footer",{class:"kv-manager-footer"},[e("div",{class:"pagination"},[e("span",null,"Page 1 of 1"),e("button",{class:"btn-ghost",disabled:""},"< Prev"),e("button",{class:"btn-ghost",disabled:""},"Next >")])],-1))]),v.value?(r(),i("div",Z,[e("div",ee,[e("form",{onSubmit:w(P,["prevent"])},[e("h1",null,c(D.value),1),e("div",te,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.key_input=a),id:"kv-key",type:"text",placeholder:"Key (e.g., app:settings:retries)",required:""},null,512),[[h,l.value.key_input]])]),e("div",ae,[b(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.value=a),id:"kv-value",rows:"5",placeholder:"Value (string or valid JSON)"},null,512),[[h,l.value.value]])]),e("div",le,[b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.tag_name=a),id:"kv-tags",type:"text",placeholder:"Tag (e.g., api)"},null,512),[[h,l.value.tag_name]])]),e("div",{class:"modal-actions"},[e("button",{type:"button",class:"btn-ghost",onClick:T},"Cancel"),t[13]||(t[13]=e("button",{type:"submit",class:"btn-primary"},"Save",-1))])],32)])])):y("",!0)]))}},ue=K(se,[["__scopeId","data-v-8212788f"]]);export{ue as default};
