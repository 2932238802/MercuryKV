import{r as d,k as U,l as H,c as u,o as i,a as e,d as y,j as T,F as L,i as N,w,t as c,b,v as h,S as v,u as M}from"./index-0COXjatw.js";import{s as m}from"./request-CUuHo27c.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"kv-manager-page"},$={class:"content-card"},B={class:"table-wrapper"},j={class:"kv-table"},q={class:"value-cell"},G={class:"value-text"},O={key:0,class:"tag"},z={class:"actions-cell"},J=["onClick"],Q=["onClick"],W=["onClick"],X={key:0},Y={colspan:"5",class:"empty-state"},Z={key:0,class:"modal-overlay"},ee={class:"modal-content"},te={class:"form-group"},ae={class:"form-group"},le={class:"form-group"},ne={__name:"Mercury",setup(se){const o=d([{tag_id:1,key_id:1,key_input:"test",value_input:"right",tag_name:"for_tset"}]),p=d(!1),f=d(!1),l=d(null),E=M(),r={CREATE:"create",UPDATE:"update"},_={FETCH:"/FetchData/fetch",CREATE:"/Alter/adddata",UPDATE:"/Alter/alterdata",DELETE:"/Alter/deletedata"},g=d(r.CREATE),D=U(()=>f.value?"Edit KV Pair":"Create KV Pair");function S(){E.push({name:"Index"})}function k(){localStorage.removeItem("AuthToken"),localStorage.removeItem("UserId"),E.push({name:"RegisterAndLogin"})}function A(){f.value=!1,l.value={key_input:"",value_input:"",tag_name:""},g.value=r.CREATE,p.value=!0}function R(n){f.value=!0,l.value={...n,tag_name:n.tag_name||""},g.value=r.UPDATE,p.value=!0}function C(){p.value=!1,l.value=null}async function V(){if(!l.value)return;const n=localStorage.getItem("UserId"),t=localStorage.getItem("AuthToken");if(!n||!t){v("User not logged in Please re-login"),k();return}if(l.value.key_input==""||l.value.value_input==""||l.value.tag_name==""){v("增加的key,value,tag不能为空哈！");return}try{if(g.value===r.CREATE){const a={user_id:Number(n),key_input:l.value.key_input,value_input:l.value.value_input,tag_name:l.value.tag_name},s=await m.post(_.CREATE,a);console.log("Response from create:",a.value),console.log("Response from create:",s.data),o.value.unshift({...l.value,kv_id:s.data.kv_id,tag_id:s.data.tag_id,updated_at:s.data.updated_at})}else if(g.value===r.UPDATE){const a={user_id:Number(n),kv_id:l.value.kv_id,key_input:l.value.key_input,value_input:l.value.value_input,tag_name:l.value.tag_name};await m.put(_.UPDATE,a);const s=o.value.findIndex(P=>P.kv_id===l.value.kv_id);s!==-1&&(o.value[s]={...l.value,updated_at:new Date().toLocaleString()})}}catch(a){console.error("Submission failed:",a),v(a.response?.data?.message||a.message||"An unknown error occurred.")}C()}async function x(n){if(confirm(`你确定要删除这个"${n.key_input}"?`)){console.log("Deleting item:",n);try{await m.delete(`${_.DELETE}/${n.kv_id}`),o.value=o.value.filter(t=>t.kv_id!==n.kv_id)}catch(t){console.error("Deletion failed:",t),v(t.response?.data?.message||"Failed to delete item.")}}}const I=async()=>{const n=localStorage.getItem("UserId");if(!n){k();return}try{const t=await m.get(_.FETCH,{params:{user_id:n}});o.value=t.data||[]}catch(t){console.error("Failed to fetch data:",t),v(" 数据加载失败 ")}};return H(()=>{I()}),(n,t)=>(i(),u("div",K,[e("div",$,[e("button",{class:"btn-return",onClick:S,title:"Go back"},t[3]||(t[3]=[e("i",{class:"fas fa-arrow-left"},null,-1)])),e("header",{class:"kv-manager-header"},[t[6]||(t[6]=e("h1",null,"KV Store",-1)),e("div",{class:"toolbar"},[t[5]||(t[5]=e("input",{type:"text",class:"search-input",placeholder:"Search by key or tag...","aria-label":"Search Key-Value pairs"},null,-1)),e("button",{class:"btn-primary",onClick:A},"+ Add New"),e("button",{class:"btn-ghost",onClick:k,title:"Logout and login again"},t[4]||(t[4]=[e("i",{class:"fas fa-sign-out-alt"},null,-1),T(" Re-Login ")]))])]),e("div",B,[e("table",j,[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",{class:"col-key"},"Key(key_input)"),e("th",{class:"col-value"},"Value(value_input)"),e("th",{class:"col-tags"},"Tag(tag_name)"),e("th",{class:"col-updated"},"Last Updated(updated_at)"),e("th",{class:"col-actions"},"Actions")])],-1)),e("tbody",null,[(i(!0),u(L,null,N(o.value,a=>(i(),u("tr",{key:a.key_id},[e("td",null,c(a.key_input),1),e("td",q,[e("span",G,c(a.value_input),1)]),e("td",null,[a.tag_name?(i(),u("span",O,c(a.tag_name),1)):y("",!0)]),e("td",null,c(new Date(a.updated_at).toLocaleString()),1),e("td",z,[e("button",{class:"btn-icon",title:"View History",onClick:s=>n.handleViewHistory(a)},t[7]||(t[7]=[e("i",{class:"fas fa-history"},null,-1)]),8,J),e("button",{class:"btn-icon",title:"Edit",onClick:s=>R(a)},t[8]||(t[8]=[e("i",{class:"fas fa-pencil-alt"},null,-1)]),8,Q),e("button",{class:"btn-icon btn-danger",title:"Delete",onClick:s=>x(a)},t[9]||(t[9]=[e("i",{class:"fas fa-trash-alt"},null,-1)]),8,W)])]))),128)),o.value.length?y("",!0):(i(),u("tr",X,[e("td",Y,[t[10]||(t[10]=T(" No Key-Value pairs found ")),e("a",{href:"#",onClick:w(A,["prevent"])},"Add one now!")])]))])])]),t[12]||(t[12]=e("footer",{class:"kv-manager-footer"},[e("div",{class:"pagination"},[e("span",null,"Page 1 of 1"),e("button",{class:"btn-ghost",disabled:""},"< Prev"),e("button",{class:"btn-ghost",disabled:""},"Next >")])],-1))]),p.value?(i(),u("div",Z,[e("div",ee,[e("form",{onSubmit:w(V,["prevent"])},[e("h1",null,c(D.value),1),e("div",te,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value.key_input=a),id:"kv-key",type:"text",placeholder:"电脑密码,工作邮箱,ssh提交密钥",required:""},null,512),[[h,l.value.key_input]])]),e("div",ae,[b(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=a=>l.value.value_input=a),id:"kv-value",rows:"5",placeholder:"123，123@123.com,36218631278631..."},null,512),[[h,l.value.value_input]])]),e("div",le,[b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.tag_name=a),id:"kv-tags",type:"text",placeholder:"生活,工作,编程"},null,512),[[h,l.value.tag_name]])]),e("div",{class:"modal-actions"},[e("button",{type:"button",class:"btn-ghost",onClick:C},"Cancel"),t[13]||(t[13]=e("button",{type:"submit",class:"btn-primary"},"Save",-1))])],32)])])):y("",!0)]))}},re=F(ne,[["__scopeId","data-v-446d12ea"]]);export{re as default};
